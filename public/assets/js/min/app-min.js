var alt;alt=angular.module("alt",["ngResource","ngRoute","toaster","firebase","masonry","ngSanitize","com.2fdevs.videogular","com.2fdevs.videogular.plugins.controls","com.2fdevs.videogular.plugins.poster","angular-preload-image"]),alt.constant("FIREBASE_URL","https://alovelything.firebaseio.com"),alt.run(function(e,r){return e.$on("$routeChangeError",function(r,t,n,o){return"AUTH_REQUIRED"===o?e.message="":void 0})}),alt.config(function(e,r){return r.html5Mode(!0),e.when("/",{templateUrl:"views/pages/index.html"}).when("/signup",{templateUrl:"views/pages/user/signup.html"}).when("/info/:section",{templateUrl:"views/pages/info/info.html"}).when("/user/:userID/love/loves",{templateUrl:"views/pages/user/loves.html"}).when("/user/:userID/love/reserves",{templateUrl:"views/pages/user/reserves.html"}).when("/user/:userID/love/follows",{templateUrl:"views/pages/user/follows.html"}).when("/user/:userID/profile",{templateUrl:"views/pages/user/profile.html"}).when("/brand/:brand/products",{templateUrl:"views/pages/brand/products.html"}).when("/brand/:brand/brand",{templateUrl:"views/pages/brand/brand.html"}).when("/brand/:brand/inspirations",{templateUrl:"views/pages/brand/inspirations.html"}).when("/brand/:brand/traces",{templateUrl:"views/pages/brand/traces.html"}).when("/search",{templateUrl:"views/pages/search/search.html"}).when("/search/:section",{templateUrl:"views/pages/search/search-section.html"}).when("/explore/:gender/:category",{templateUrl:"views/pages/explore/explore.html",reloadOnSearch:!1}).when("/product/:productID",{templateUrl:"views/pages/product/product.html"}).when("/admin/products",{templateUrl:"views/pages/admin/products.html",resolve:{currentAuth:function(e){return e.requireAuth()}}}).otherwise({redirectTo:"/"})}),alt.controller("authCtrl",function(e,r,t,n,o){return e.login=function(){return n.login(e.user).then(function(e){return t.path("/"),o.pop("success","Successfully login"),r.reload()})["catch"](function(e){switch(e.code){case"INVALID_USER":return o.pop("warning","Invalid user email");case"INVALID_PASSWORD":return o.pop("warning","Invalid password");default:return o.pop("warning",e)}})},e.logout=function(){n.logout(),o.pop("success","Successfully logout")},e.register=function(){n.register(e.user).then(function(u){return n.storeUserInfo(e.user,u),o.pop("success","Successfully registered"),n.login(e.user).then(function(e){return t.path("/"),o.pop("success","Successfully login"),r.reload()})})["catch"](function(e){switch(e.code){case"EMAIL_TAKEN":return o.pop("warning","Email has been taken");default:return o.pop("warning",e)}})}}),alt.controller("brandCtrl",function(e,r,t,n,o,u,l,c,i,a,s){var d;return d=t.path().split("/"),e.brand=o.brand,e.brandChapters=["products","brand","inspirations","traces"],e.brand&&(e.brandData=i.getBrand(o.brand.replace(/\s/g,"")),e.brandData.on("value",function(t){return r(function(){return console.log(t.val()),e.brandIntro="/assets/brands/"+t.val().intro,e.brandTitle=t.val().title,e.brandStory="/assets/brands/"+t.val().article},0)}),e.brandProducts=i.getBrandProducts(e.brand),e.ready=!1,r(function(){return e.brandInspirations=i.getBrandInspirations(e.brand),e.ready=!0},500),e.brandTraces=i.getBrandTraces(e.brand)),void 0!==u.currentUser.$id?e.followBrand=function(e){return i.followBrand(e)}:e.followBrand=function(e,r){return s.pop("warning","Please login or signup first"),t.path("/signup")},e.unfollowBrand=function(e){return i.unfollowBrand(e),"user"===d[1]&&"follows"===d[4]?n.reload():void 0},o.userID&&i.followedBrands(o.userID).then(function(r){return e.followedBrands=r}),void 0!==u.currentUser.$id&&i.currentUserFollowedBrands().$loaded().then(function(r){return e.ifFollowed=function(e){var t;return t=r.$getRecord(e),null!==t?!0:!1}}),e.chapterActive=function(e){var r;return d=t.path().split("/"),null!=(r=e===d[3])?r:{active:""}}}),alt.controller("exploreCtrl",function(e,r,t,n,o,u){var l,c,i,a;return a=["look1","look2"],i=_.first(_.shuffle(a)),e.gender=n.gender,c="man"===n.gender?"x":"y",l=_.capitalize(n.category),e.ifGender=function(e){return e===n.gender?!0:!1},e.ifCategory=function(e){return e===n.category?!0:!1},e.shuffleLook=function(){return t.reload()},e.ready=!1,u.getRelateProducts(i).then(function(r){return e.relateProducts=r}),u.getExploreProducts(c,l).then(function(r){return e.exploreProducts=r,_.forEach(r,function(e){return console.log(e.color)}),e.ready=!0})}),alt.controller("flagsCtrl",function(e,r,t,n,o,u,l,c){var i;return i=t.path().split("/")}),alt.controller("infoCtrl",function(e,r,t,n,o,u,l){return e.section=n.section,e.info=l.getInfo(),l.getInfoSection(e.section).child("/title").on("value",function(t){return r(function(){return e.infoTitle=t.val(),e.infoBody="/views/pages/info/"+e.section+".html"},0)}),e.sectionActive=function(e){var r,n;return r=t.path().split("/"),null!=(n=e===r[2])?n:{active:""}}}),alt.controller("productsCtrl",function(e,r,t,n,o,u,l,c,i,a){var s,d;return s=t.path().split("/"),e.ready=!1,i.getRandomProducts().then(function(r){return e.randomProducts=r,e.ready=!0}),i.getPreferProducts().then(function(r){return e.preferProducts=r}),o.userID&&i.getUserFlaggedProducts(s[4],o.userID).then(function(r){return e.userFlaggedProducts=r}),d=o.productID,void 0!==d&&(e.productID=d,i.getProduct(d).on("value",function(r){return l(function(){return e.productName=r.val().name,e.productImage=r.val().image,e.productBrand=r.val().brand,e.productPrice=r.val().price,e.productCategory=r.val().category,e.productColor=_(r.val().color).toString().replace(/,/g,", "),e.productMaterial=_(r.val().material).toString().replace(/,/g,", "),e.productPurchace=r.val().purchace},0)})),e.addProduct=function(){return i.addProduct(e),e.name=""},e.deleteProduct=function(e){return i.deleteProduct(e)}}),alt.controller("searchCtrl",function(e,r,t,n){var o;return n.getProducts().then(function(r){return e.products=r}),e.section=r.section,console.log(e.section),o=[{value:"brand",text:"Brand"},{value:"name",text:"Product"},{value:"id",text:"Love"},{value:"price",text:"Price"}],void 0!==e.section&&(e.sectionText=_.where(o,{value:e.section})[0].text,console.log(e.sectionText)),e.query=t.search().target}),alt.controller("userCtrl",function(e,r,t,n,o,u,l,c){var i,a,s;return i=t.path().split("/"),e.sectionActive=function(e){var r;return null!=(r=e===i[3])?r:{active:""}},e.subSectionActive=function(e){var r;return null!=(r=e===i[4])?r:{active:""}},e.ifUnderLove=function(){return"love"===i[3]?!0:!1},e.userID=s=n.userID,c.getUser(s).then(function(r){return e.user=r,console.log(e.user.category)}),a=function(e){var r;return r=[],_.forEach(e,function(e){return e.$value===!0?r.push(_.capitalize(e.$id)):void 0}),_(r).toString()},c.getUserFashion(s).on("value",function(r){return"x"===r.val()?e.fashion="Man's fashion":e.fashion="Woman's fashion"}),c.getUserColour(s).then(function(r){return e.colours=a(r)}),c.getUserCategory(s).then(function(r){return e.categories=a(r)}),c.getUserBrand(s).then(function(r){var t;return t=[],_.forEach(r,function(e){return""!==e.$value?t.push(_.capitalize(e.$value)):void 0}),e.brands=_(t).toString()}),c.getUserNewsletter(s).on("value",function(r){return r.val()===!0?e.newsletter="You have subscribbed to our newsletter and recommendation":e.newsletter="You have not yet subscribbed to our newsletter and recommendation"}),e.userInfoUpdate=function(){return c.updateUserInfo(e.user),r.reload()}}),alt.filter("colourFilter",function(e){return function(r,t){return e.search().colour&&(t.colourIncludes=_.isArray(e.search().colour)?e.search().colour:[e.search().colour]),t.colourIncludes.length>0&&r?r.filter(function(e){return _.intersection(e.color,t.colourIncludes).length>0}):r}}),alt.filter("wordsTrunc",function(){return function(e,r){return e?(r=parseInt(r,20),!r||e.length<=r?e:e.substr(0,r)+" â€¦"):""}}),alt.factory("auth",function(e,r,t,n){var o,u,l;return l=new Firebase(r),o=t(l),o.$onAuth(function(t){var o,u;return t?(u=new Firebase(r+"/users/"+t.uid),o=n(u),e.currentUser=o):e.currentUser=""}),u={login:function(e){return o.$authWithPassword(e)},logout:function(){return o.$unauth()},register:function(e){return o.$createUser(e)},storeUserInfo:function(e,t){var n,o;o=new Firebase(r+"/users"),void 0===e.newsletter&&(e.newsletter=!1),n={uid:t.uid,firstname:e.firstname,lastname:e.lastname,username:"",email:e.email,fashion:e.fashion,newsletter:e.newsletter,address:"",colour:"",category:"",brand:"",loves:"",follows:"",reserves:"",date:Firebase.ServerValue.TIMESTAMP},o.child(t.uid).set(n,function(){return console.log(n)})},requireAuth:function(){return o.$requireAuth()},getCurrentUser:function(e){var t;return t=new Firebase(r+"/users/"+e),n(t)}}}),alt.factory("brand",function(e,r,t,n){var o,u,l,c,i,a;return o=new Firebase(r+"/brands"),c=new Firebase(r+"/products"),u=new Firebase(r+"/inspirations"),i=new Firebase(r+"/traces"),a=new Firebase(r+"/users"),l={getBrand:function(e){return o.child(e)},getBrandProducts:function(e){return t(c.orderByChild("brand").equalTo(e))},getBrandInspirations:function(e){return t(u.orderByChild("brand").equalTo(e))},getBrandTraces:function(e){return t(i.orderByChild("brand").equalTo(e))},followBrand:function(r){var n,u,l,c,i;return n=o.child(r).child("follows"),c=o.child(r).child("followsCount"),l=t(n),u={date:Firebase.ServerValue.TIMESTAMP},n.child(e.currentUser.$id).set(u,function(){return console.log("Follow added to brand"),c.set(l.length,function(){return console.log("Follows counted")})}),i=a.child(e.currentUser.$id).child("follows"),i.child(r).set(u,function(){return console.log("Follow added to user")})},unfollowBrand:function(r){var n,u,l,c;return n=o.child(r).child("follows"),l=o.child(r).child("followsCount"),u=t(n),n.child(e.currentUser.$id).remove(function(){return console.log("Follow removed from brand"),l.set(u.length,function(){return console.log("Follows counted")})}),c=a.child(e.currentUser.$id).child("follows").child(r),c.remove(function(){return console.log("Follow removed from user")})},followedBrands:function(e){var r,u,l,c;return r=[],l=a.child(e).child("follows"),u=t(l),c=u.$loaded(function(e){return _.forEach(e,function(e){var t;return t=n(o.child(e.$id)),r.push(t)}),r})},currentUserFollowedBrands:function(){var r;return r=a.child(e.currentUser.$id).child("follows"),t(r)}}}),alt.factory("info",function(e,r,t,n){var o,u;return o=new Firebase(r+"/info"),u={getInfo:function(){return t(o)},getInfoSection:function(e){return o.child(e)}}}),alt.factory("products",function(e,r,t,n,o){var u,l,c,i;return c=new Firebase(r+"/products"),l=t(c),i=new Firebase(r+"/users"),u={getProducts:function(){var e;return e=l.$loaded(function(e){return e})},getRandomProducts:function(){var e;return e=l.$loaded(function(e){return _.shuffle(e)})},getPreferProducts:function(){var r;return r=l.$loaded(function(r){return o.getCurrentUser(e.currentUser.$id).$loaded().then(function(e){var t;return t=_.where(r,{gender:[e.fashion]}),_.shuffle(t)})})},getExploreProducts:function(e,r){var t;return t=l.$loaded(function(t){var n;return n="All"===r?_.where(t,{gender:[e]}):_.where(t,{gender:[e],category:r})})},getRelateProducts:function(e){var r;return r=l.$loaded(function(r){var t;return t=_.where(r,{relate:e})})},getProduct:function(e){return c.child(e)},addProduct:function(e){var r;return r={name:e.name,date:Firebase.ServerValue.TIMESTAMP},c.push(r,function(){return console.log("Product added")})},deleteProduct:function(e){var r;return r=c.child(e),r.child("loves").on("value",function(t){return null!==t.val()?t.forEach(function(t){return i.child(t.key()).child("loves").child(e).remove(function(){return console.log("Love removed from user")}),r.remove(function(){return console.log("Product deleted")})}):r.remove(function(){return console.log("Product deleted")})})},flagProduct:function(r,n){var o,u,l,a,s;return a=c.child(n).child(r+"s"),u=c.child(n).child(r+"sCount"),o=t(a),l={date:Firebase.ServerValue.TIMESTAMP},a.child(e.currentUser.$id).set(l,function(){return console.log(r+" added to product"),u.set(o.length,function(){return console.log(r+" counted")})}),s=i.child(e.currentUser.$id).child(r+"s"),s.child(n).set(l,function(){return console.log(r+" added to user")})},disflagProduct:function(r,n){var o,u,l,a;return l=c.child(n).child(r+"s"),u=c.child(n).child(r+"sCount"),o=t(l),l.child(e.currentUser.$id).remove(function(){return console.log(r+" removed from product"),u.set(o.length,function(){return console.log(r+" counted")})}),a=i.child(e.currentUser.$id).child(r+"s").child(n),a.remove(function(){return console.log(r+" removed from user")})},getUserFlaggedProducts:function(e,r){var o,u,l,a;return o=[],l=i.child(r).child(e),u=t(l),a=u.$loaded(function(e){return _.forEach(e,function(e){var r;return r=n(c.child(e.$id)),o.push(r)}),o})},getCurrentUserFlaggedProducts:function(r){var n;return n=i.child(e.currentUser.$id).child(r+"s"),t(n)}}}),alt.factory("user",function(e,r,t,n,o){var u,l,c;return c=new Firebase(r+"/users"),l=function(e){return n(productsRef.child(e))},u={getUser:function(e){var r,t;return t=n(c.child(e)),r=t.$loaded(function(e){return e})},getUserColour:function(e){var r,n;return r=t(c.child(e).child("colour")),n=r.$loaded(function(e){return e})},getUserCategory:function(e){var r,n;return r=t(c.child(e).child("category")),n=r.$loaded(function(e){return e})},getUserBrand:function(e){var r,n;return r=t(c.child(e).child("brand")),n=r.$loaded(function(e){return e})},getUserFashion:function(e){return c.child(e).child("fashion")},getUserNewsletter:function(e){return c.child(e).child("newsletter")},updateUserInfo:function(e){var r,t;void 0!==e&&(t=o.userID,r=n(c.child(t)),r.$loaded(function(r){var t,n,o,u,l,i,a,s,d,f,h,v,g;return i=""===e.firstname?r.firstname:e.firstname,s=""===e.lastname?r.lastname:e.lastname,g=""===e.username?r.username:e.username,t=""===e.address?r.address:e.address,l=""===e.fashion?r.fashion:e.fashion,u=""===e.colour?r.colour:e.colour,o=""===e.category?r.category:e.category,n=""===e.brand?r.brand:e.brand,f=""===e.newsletter?r.newsletter:e.newsletter,d=void 0===r.loves?"":r.loves,a=void 0===r.follows?"":r.follows,h=void 0===r.reserves?"":r.reserves,v={uid:r.uid,date:r.date,firstname:i,lastname:s,username:g,email:r.email,address:t,fashion:l,colour:u,category:o,brand:n,newsletter:f,loves:d,follows:a,reserves:h},c.child(e.$id).set(v,function(){})}))}}}),alt.directive("addthisToolbox",function(){return{restrict:"A",transclude:!0,replace:!0,template:"<div ng-transclude></div>",link:function(e,r,t){addthis.init(),addthis.toolbox($(r).get())}}}),alt.directive("adminProducts",function(){return{restrict:"A",templateUrl:"/views/directives/admin-products.html",scope:!0,controller:function(e){return e.deleting=!1,e.startDelete=function(){return e.deleting=!0},e.cancelDelete=function(){return e.deleting=!1}}}}),alt.directive("fancybox",function(){return{restrict:"A",link:function(e,r,t){return $(r).fancybox(),e.$last?$(".fancybox").fancybox():void 0}}}),alt.directive("filterProducts",function(e,r,t){return{restrict:"A",controller:function(e){return t.search().colour?e.colourIncludes=_.isArray(t.search().colour)?t.search().colour:[t.search().colour]:e.colourIncludes=[],e.includeColour=function(n){var o;return o=_.indexOf(e.colourIncludes,n),o>-1?e.colourIncludes.splice(o,1):e.colourIncludes.push(n),e.$watch("colourIncludes",function(n,o){return e.colourIncludes=_.union(e.colourIncludes,t.search().colour),t.search("colour",e.colourIncludes),0===n.length?r.reload():void 0},!0)}},link:function(e,r,t){return $(".filter-button.colour").click(function(){var e;return e=$("input",this).is(":checked"),e?$(this).addClass("active"):$(this).removeClass("active")}),$(".filter-button.order").click(function(){return $(".filter-button.order").removeClass("active"),$(this).addClass("active")})}}}),alt.directive("listProducts",function(e,r,t,n,o){return{restrict:"AE",templateUrl:"/views/directives/list-products.html",controller:function(u){var l;return l=r.path().split("/"),u.flagProduct=function(e,u){return void 0!==t.currentUser.$id?n.flagProduct(e,u):(r.path("/signup"),o.pop("warning","Please register or log in first"))},u.disflagProduct=function(r,t){var o;return n.disflagProduct(r,t),o=l[4],o&&"loves"===o||"reserves"===o?e.reload():void 0},void 0!==t.currentUser.$id?(n.getCurrentUserFlaggedProducts("love").$loaded().then(function(e){return u.ifLoved=function(r){var t;return t=e.$getRecord(r),null!==t?!0:!1}}),n.getCurrentUserFlaggedProducts("reserve").$loaded().then(function(e){return u.ifReserved=function(r){var t;return t=e.$getRecord(r),null!==t?!0:!1}})):void 0}}}),alt.directive("scrollTrigger",function(e){return{link:function(r,t,n){var o,u,l;return l=parseInt(n.threshold)||0,u=jQuery(t[0]),o=jQuery(document),angular.element(document).bind("scroll",function(){return o.scrollTop()+e.innerHeight+l>u.offset().top?r.$apply(n.scrollTrigger):void 0})}}}),alt.directive("searchResults",function(){return{restrict:"A",templateUrl:"/views/directives/search-results.html"}}),alt.directive("videoPlayer",function(){return{restrict:"A",templateUrl:"/views/directives/video-player.html",scope:"true",controller:function(e,r,t){return t.getBrand(e.brand).child("videoFile").on("value",function(n){return e.brandVideo=n.val(),t.getBrand(e.brand).child("videoPoster").on("value",function(t){return e.brandVideoPoster=t.val(),e.config={autoHide:!0,preload:"none",sources:[{src:r.trustAsResourceUrl("/assets/brands/"+e.brandVideo),type:"video/mp4"}],theme:{url:"/assets/css/videogular.css"},plugins:{poster:"/assets/brands/"+e.brandVideoPoster}}})})}}}),alt.directive("wrapProducts",function(e,r,t,n,o){return{restrict:"E",replace:!0,templateUrl:"/views/directives/wrap-products.html",scope:{products:"="},controller:function(r){var t;return t=e.path().split("/"),r.$watch("products",function(e,t){var n,u;return r.productsInit=_.slice(r.products,0,15),u=_.slice(r.products,15),n=[],o(function(){return r.update(),o(function(){return r.update()},500)},500),r.loadMore=function(){var e,t;for(t=n.length-1,e=1;15>=e&&e+t<u.length;)n.push(u[t+e]),e++;return r.productsLoad=n,o(function(){return r.update()},500)}},!0)}}});